/*
 * Copyright (C) Ericsson Mobile Communications AB, 2000.
 * Licensed to AU-System AB.
 * All rights reserved.
 *
 * This software is covered by the license agreement between
 * the end user and AU-System AB, and may be used and copied
 * only in accordance with the terms of the said agreement.
 *
 * Neither Ericsson Mobile Communications AB nor AU-System AB
 * assumes any responsibility or liability for any errors or inaccuracies in
 * this software, or any consequential, incidental or indirect damage arising
 * out of the use of the Generic WAP Client software.
 */
/*
******************************************************************************
**      env.c for system WAP
** 
** This file has been generated by the Bodybuilder - Version 1.30
** Date : 20.04.00
** 
** ATTENTION!
** The user must modify this file in the apropriate sections surrounded by 
** "BEGIN User Code" and "END User Code"
** All modifications done within these sections will be saved, all the other
** ones will be lost when creating this file again.
** Do NOT delete, add or modify the lines "BEGIN User Code" and 
** "END User Code"
******************************************************************************
*/

#define XMK_ENV_TIME 956222123

#ifndef __ENV_C_ 
#define __ENV_C_ 


#include "ml_typ.h" 

#include "WAP.ifc" 

/* BEGIN User Code (global section)*/
/*
 * Copyright (C) Ericsson Mobile Communications AB, 2000.
 * Licensed to AU-System AB.
 * All rights reserved.
 *
 * This software is covered by the license agreement between
 * the end user and AU-System AB, and may be used and copied
 * only in accordance with the terms of the said agreement.
 *
 * Neither Ericsson Mobile Communications AB nor AU-System AB
 * assumes any responsibility or liability for any errors or inaccuracies in
 * this software, or any consequential, incidental or indirect damage arising
 * out of the use of the Generic WAP Client software.
 */
#include "cmmnrsrc.h"
#include "msgqueue.h"

static  VOID    setOctetStringFromString(SDL_Octet_String *os, char *data, int len)
{
    if (data != NULL)
    {
        os->Length = len;
        os->IsAssigned = (xbool)XMK_TRUE;
        os->Bits = data;
    }
    else
    {
/*
  compare: SDL_Bit_String xMkString_SDL_Bit_String ()
*/
        os->Length = 1;
        os->IsAssigned = (xbool)XMK_FALSE;
        os->Bits = (unsigned char *)OSConnectorAlloc(1);
    }
    os->IsUsedInSignal = (xbool)XMK_TRUE;
}

/*   END User Code (global section)*/

#ifdef XMK_USE_xInitEnv
/*
+------------------------------------------------------------------------------+
|  Functionname : xInitEnv                                                     |
+------------------------------------------------------------------------------+
|                                                                              |
|  Description :                                                               |
|  This function is called by the Cmicro Kernel during initialization of the   |
|  SDL-System.                                                                 |
|                                                                              |
|  Parameter    : -                                                            |
|  Return       : -                                                            |
|                                                                              |
+------------------------------------------------------------------------------+
*/
#ifndef XNOPROTO
  void xInitEnv (void)
#else
  void xInitEnv ()
#endif
{

  /* BEGIN User Code (variable section)*/
  /* It is possible to define some variables here */
  /*   END User Code (variable section)*/

  #ifdef XMK_ADD_PRINTF_USER
    XMK_FUNCTION("xInitEnv");
  #endif

  /* BEGIN User Code (init section) */
  /* Do the actions here to initialize your environment */
  /*   END User Code (init section) */

  #ifdef XMK_ADD_PRINTF_USER
    XMK_TRACE_EXIT("xInitEnv");
  #endif
} /* END OF FUNCTION */
#endif /* ... XMK_USE_xInitEnv */

#ifdef XMK_USE_xInEnv
/*
+------------------------------------------------------------------------------+
|  Functionname : xInEnv                                                       |
+------------------------------------------------------------------------------+
|                                                                              |
|  Description :                                                               |
|  This function is called by the Cmicro Kernel continuously to retrieve       |
|  signals polled from the Environment.                                        |
|                                                                              |
|  The use of xInEnv() is not absolutely necessary in the case, where          |
|  the Cmicro Kernel is scaled to preemption, and all external Events are      |
|  put into the SDL-System via an Interrupt Service Routine, which is to be    |
|  written by the user.                                                        |
|                                                                              |
|  Parameter    : -                                                            |
|  Return       : -                                                            |
+------------------------------------------------------------------------------+
*/
#ifndef XNOPROTO
   void xInEnv (void)
#else
   void xInEnv ()
#endif
{

   XMK_SEND_TMP_VARS

   /* BEGIN User Code (variable section)*/
   /* It is possible to define some variables here      */
   /* or to insert a functionality which must be polled */
   MsgId    pMsg_Id;
   Msg *pMsg = GetMsg();
   if (pMsg)
   {
       pMsg_Id = (eUndefined < pMsg->Id && pMsg->Id < eEnd) ? pMsg->Id : eUndefined;
       if (!(eUndefined < pMsg_Id && pMsg_Id < eEnd))
       {
           /* Undefined connector function! */
           OSConnectorFree(pMsg);
           return;
       }
   }
   else
   {
       return;
   }

   /* First of all, is the msg a timer? */
   if (pMsg_Id == eCLNTc_timerExpired)
   {
       timerExpired();
       OSConnectorFree(pMsg);
       return;
   }

   /*   END User Code (variable section)*/

  #ifdef XMK_ADD_PRINTF_USER
    XMK_FUNCTION("xInEnv");
  #endif /* ... XMK_ADD_PRINTF_USER */

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_initialised)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  Initialized,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WAE_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_loadURL)
  /*   END User Code */
  {
    yPDef_LoadURL var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->sz;
    var.Param3 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  LoadURL,
                  xDefaultPrioSignal,
                  sizeof( yPDef_LoadURL ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_reload)
  /*   END User Code */
  {
    yPDef_ReloadCard var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ReloadCard,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ReloadCard ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eMMIc_openView)
  /*   END User Code */
  {
    yPDef_OpenView var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  OpenView,
                  xDefaultPrioSignal,
                  sizeof( yPDef_OpenView ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eMMIc_closeView)
  /*   END User Code */
  {
    yPDef_CloseView var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  CloseView,
                  xDefaultPrioSignal,
                  sizeof( yPDef_CloseView ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eDiscardAllContext)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  DiscardAllContext,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eMMIc_inputString)
  /*   END User Code */
  {
    yPDef_InputString var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->pWCHAR;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  InputString,
                  xDefaultPrioSignal,
                  sizeof( yPDef_InputString ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_stop)
  /*   END User Code */
  {
    yPDef_Abort var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  Abort,
                  xDefaultPrioSignal,
                  sizeof( yPDef_Abort ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_goBack)
  /*   END User Code */
  {
    yPDef_GoBack var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  GoBack,
                  xDefaultPrioSignal,
                  sizeof( yPDef_GoBack ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_passwordDialogResponse)
  /*   END User Code */
  {
    yPDef_PasswordDialogResponse var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->pCHAR[0];
    var.Param4 = pMsg->pCHAR[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  PasswordDialogResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_PasswordDialogResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UA_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_promptDialogResponse)
  /*   END User Code */
  {
    yPDef_PromptDialogResponse var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->pWCHAR;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  PromptDialogResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_PromptDialogResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WMLS_SM,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_confirmDialogResponse)
  /*   END User Code */
  {
    yPDef_ConfirmDialogResponse var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ConfirmDialogResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ConfirmDialogResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WMLS_SM,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_alertDialogResponse)
  /*   END User Code */
  {
    yPDef_AlertDialogResponse var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  AlertDialogResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_AlertDialogResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WMLS_SM,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_WMLSLibFuncResponse)
  /*   END User Code */
  {
    yPDef_WMLSLibFuncResponse var;

  /* BEGIN User Code */
    /* This signal only works when USE_PROPRIETARY_WMLS_LIBS is set anyway. */
    #ifdef USE_PROPRIETARY_WMLS_LIBS
    var.Param1 = pMsg->vUINT16[0];
    var.Param2 = pMsg->pWMLSvar;
    #endif
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  WMLSLibFuncResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_WMLSLibFuncResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WMLS_SM,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_getContent)
  /*   END User Code */
  {
    yPDef_GetContent var;

  /* BEGIN User Code */
    var.Param1 = pMsg->sz;
    var.Param2 = pMsg->vUINT8[0];
    var.Param3 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  GetContent,
                  xDefaultPrioSignal,
                  sizeof( yPDef_GetContent ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_CONT_UA,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_keySelected)
  /*   END User Code */
  {
    yPDef_KeySelected var;

	CLNTa_log(0,0,"ENV:eMMIc_keySelected]---------------------------");
  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  KeySelected,
                  xDefaultPrioSignal,
                  sizeof( yPDef_KeySelected ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_MMI_DISP,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eMMIc_optionSelected)
  /*   END User Code */
  {
    yPDef_ChangeOptionState var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ChangeOptionState,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ChangeOptionState ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_MMI_DISP,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_imageSelected)
  /*   END User Code */
  {
    yPDef_ImageSelected var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ImageSelected,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ImageSelected ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_MMI_DISP,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_textSelected)
  /*   END User Code */
  {
    yPDef_TextSelected var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  TextSelected,
                  xDefaultPrioSignal,
                  sizeof( yPDef_TextSelected ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_MMI_DISP,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMMIc_linkInfo)
  /*   END User Code */
  {
    yPDef_LinkInfo var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->vUINT8[2];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  LinkInfo,
                  xDefaultPrioSignal,
                  sizeof( yPDef_LinkInfo ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_MMI_DISP,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_confirmDownload)
  /*   END User Code */
  {
    yPDef_DownloadConfirm var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vINT16;
    var.Param2 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  DownloadConfirm,
                  xDefaultPrioSignal,
                  sizeof( yPDef_DownloadConfirm ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMEMc_initCache)
  /*   END User Code */
  {
    yPDef_InitCache var;

  /* BEGIN User Code */
    var.Param1 = pMsg->memSize[0];
    var.Param2 = pMsg->memSize[1];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  InitCache,
                  xDefaultPrioSignal,
                  sizeof( yPDef_InitCache ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_CC,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eMEMc_prepareCache)
  /*   END User Code */
  {
    yPDef_PrepareCache var;

  /* BEGIN User Code */
    var.Param1 = pMsg->memSize[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  PrepareCache,
                  xDefaultPrioSignal,
                  sizeof( yPDef_PrepareCache ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_CC,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_usePort)
  /*   END User Code */
  {
    yPDef_ClntUsePort var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vUINT8[1];
    var.Param3 = pMsg->vUINT16[0];
    var.Param4 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ClntUsePort,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ClntUsePort ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_closePort)
  /*   END User Code */
  {
    yPDef_ClntClosePort var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT16[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ClntClosePort,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ClntClosePort ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_ME,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_file)
  /*   END User Code */
  {
    yPDef_GetFileResponse var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->pCHAR[0];
    var.Param3 = pMsg->vUINT16[0];
    var.Param4 = pMsg->sz;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  GetFileResponse,
                  xDefaultPrioSignal,
                  sizeof( yPDef_GetFileResponse ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_FC,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_functionResult)
  /*   END User Code */
  {
    yPDef_CallFunctionResult var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->pCHAR[0];
    var.Param3 = pMsg->vUINT16[0];
    var.Param4 = pMsg->sz;
    var.Param5 = pMsg->ppVariableType;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  CallFunctionResult,
                  xDefaultPrioSignal,
                  sizeof( yPDef_CallFunctionResult ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_RES_FC,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_start)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  StartWAPStack,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_StackCtrl,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eCLNTc_terminate)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  TerminateWAPStack,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_StackCtrl,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eCLNTc_timerExpired)
  /*   END User Code */
  {
    yPDef_ParaTimer var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ParaTimer,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ParaTimer ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_TransactionManager,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eUSSDc_receivedResultProcessRequest)
  /*   END User Code */
  {
    yPDef_ProcUSSDReqCnf var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    setOctetStringFromString(&(var.Param2), pMsg->pCHAR[0], pMsg->vUINT8[1]);
    var.Param3 = pMsg->vUINT8[1];   /*onödig ty finns i octetsträng*/
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  ProcUSSDReqCnf,
                  xDefaultPrioSignal,
                  sizeof( yPDef_ProcUSSDReqCnf ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UDCPDialogueHandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eUSSDc_receivedInvokeRequest)
  /*   END User Code */
  {
    yPDef_USSDReqInd var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[1];
    setOctetStringFromString(&(var.Param2), pMsg->pCHAR[0], pMsg->vUINT8[1]);
    var.Param3 = pMsg->vUINT8[0];   /*onödig ty finns i octetsträng*/
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  USSDReqInd,
                  xDefaultPrioSignal,
                  sizeof( yPDef_USSDReqInd ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UDCPDialogueHandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eUSSDc_receivedError)
  /*   END User Code */
  {
    yPDef_USSDErrorInd var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    var.Param2 = pMsg->vBOOL;
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  USSDErrorInd,
                  xDefaultPrioSignal,
                  sizeof( yPDef_USSDErrorInd ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UDCPDialogueHandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eUSSDc_receivedRelease)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  USSDReleaseInd,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_UDCPDialogueHandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eSMSc_receivedRequest)
  /*   END User Code */
  {
    yPDef_RecSMSDatagram var;

  /* BEGIN User Code */
    var.Param1 = pMsg->pCHAR[1]; /*data*/
    var.Param2 = pMsg->vUINT8[1]; /*data length*/
    devaddr_store(&(var.Param3), pMsg->pCHAR[0], pMsg->vUINT8[0]);
    OSConnectorFree(pMsg->pCHAR[0]);
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  RecSMSDatagram,
                  xDefaultPrioSignal,
                  sizeof( yPDef_RecSMSDatagram ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_Reassemble,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eSMSc_sentRequest)
  /*   END User Code */
  {
  /* BEGIN User Code */
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  SMSsentInd,
                  xDefaultPrioSignal,
                  0,
                  NULL,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_Segmentation,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eSMSc_receivedError)
  /*   END User Code */
  {
    yPDef_SMSErrorInd var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT8[0];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  SMSErrorInd,
                  xDefaultPrioSignal,
                  sizeof( yPDef_SMSErrorInd ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_Segmentation,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
    if (pMsg_Id == eUDPc_receivedRequest)
  /*   END User Code */
  {
    yPDef_RecUDPDatagram var;

  /* BEGIN User Code */
    var.Param1 = pMsg->pCHAR[0];
    var.Param2 = pMsg->vUINT16[0];
    devaddr_store(&(var.Param3), pMsg->pCHAR[1], pMsg->vUINT8[0]);
    devaddr_store(&(var.Param4), pMsg->pCHAR[2], pMsg->vUINT8[1]);
    var.Param5 = pMsg->vUINT16[1];
    var.Param6 = pMsg->vUINT16[2];
    OSConnectorFree(pMsg->pCHAR[1]);
    OSConnectorFree(pMsg->pCHAR[2]);
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  RecUDPDatagram,
                  xDefaultPrioSignal,
                  sizeof( yPDef_RecUDPDatagram ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WDPhandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eUDPc_errorRequest)
  /*   END User Code */
  {
    yPDef_UDPErrorInd var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT16[0];  /*DestinationPort*/
    var.Param2 = pMsg->vUINT8[0];   /*FaultCode*/
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  UDPErrorInd,
                  xDefaultPrioSignal,
                  sizeof( yPDef_UDPErrorInd ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WDPhandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eWDc_receivedRequest)
  /*   END User Code */
  {
    yPDef_RecWDDatagram var;

  /* BEGIN User Code */
    var.Param1 = pMsg->pCHAR[0],
    var.Param2 = pMsg->vUINT16[0];
    yDef_DeviceAddress(&var.Param3);
    yDef_DeviceAddress(&var.Param4);
    var.Param5 = pMsg->vUINT16[1];
    var.Param6 = pMsg->vUINT16[2];
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  RecWDDatagram,
                  xDefaultPrioSignal,
                  sizeof( yPDef_RecWDDatagram ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WDPhandler,0));
    return;
  /*   END User Code */
  }

  /* BEGIN User Code */
  if (pMsg_Id == eWDc_errorRequest)
  /*   END User Code */
  {
    yPDef_WDErrorInd var;

  /* BEGIN User Code */
    var.Param1 = pMsg->vUINT16[0];  /*DestinationPort*/
    var.Param2 = pMsg->vUINT8[0];   /*FaultCode*/
    OSConnectorFree(pMsg);
  /*   END User Code */
    XMK_SEND_ENV( ENV,
                  WDErrorInd,
                  xDefaultPrioSignal,
                  sizeof( yPDef_WDErrorInd ),
                  &var,
  /* BEGIN User Code */
                  GLOBALPID(XPTID_WDPhandler,0));
    return;
  /*   END User Code */
  }

  #ifdef XMK_ADD_PRINTF_USER
    XMK_TRACE_EXIT("xInEnv");
  #endif

  return ;

} /* END OF FUNCTION */
#endif /* ... XMK_USE_xInEnv */

#ifdef XMK_USE_xOutEnv
/*
+------------------------------------------------------------------------------+
|  Functionname : xOutEnv                                                      |
+------------------------------------------------------------------------------+
|                                                                              |
|  Description :                                                               |
|  This function is called by the Cmicro Kernel, if an SDL signal is to be     |
|  sent to the environment.                                                    |
|  The user must take care for that for each possible signal there is an       |
|  appropriate handling. If a signal was handled, the function should return   |
|  with XMK_TRUE, otherwise XMK_FALSE                                          |
|                                                                              |
|  Note:                                                                       |
|  The user has several possibilities to send signals to the environment by    |
|  using #EXTSIG,#ALT or #CODE, please view the reference manual.              |
|                                                                              |
|  Parameter    :  xmk_TmpSignalID        - ID of the signal (see .ifc file)   |
|                  xmk_TmpPrio            - Priority of signal                 |
|                  xmk_TmpDataLength      - Amount of bytes in signal's        |
|                                           parameters                         |
|                 *xmk_TmpDataPtr         - Pointer to signal's parameters     |
|                  xmk_TmpReceiverPID     - PID of the receiver.               |
|  Return       : Function must return with XMK_TRUE, if Signal was sent       |
|                 to the environment, otherwise with XMK_FALSE.                |
|                                                                              |
+------------------------------------------------------------------------------+
*/
#ifndef XNOPROTO
  xmk_OPT_INT   xOutEnv (xmk_T_SIGNAL xmk_TmpSignalID
                          , xmk_T_MESS_LENGTH xmk_TmpDataLength,
                           void xmk_RAM_ptr  xmk_TmpDataPtr
                          , xPID xmk_TmpReceiverPID
                         )

#else
   xmk_OPT_INT xOutEnv  (xmk_TmpSignalID
                         , xmk_TmpDataLength,
                           xmk_TmpDataPtr
                         , xmk_TmpReceiverPID
                         )

   xmk_T_SIGNAL       xmk_TmpSignalID;
   xmk_T_MESS_LENGTH  xmk_TmpDataLength;
   void xmk_RAM_ptr  xmk_TmpDataPtr;
   xPID               xmk_TmpReceiverPID;
#endif

/*-FDEF E*/
{
  xmk_OPT_INT xmk_result = XMK_FALSE;

  /* BEGIN User Code (variable section)*/
  /* It is possible to define some variables here */
  /*   END User Code (variable section)*/

  #ifdef XMK_ADD_MICRO_ENVIRONMENT
    xmk_T_CMD_EXT_OUTPUT_TO_ENV_IND cmd_data;
  #endif

  #ifdef XMK_ADD_PRINTF_USER
    XMK_FUNCTION("xOutEnv");
  #endif

  #ifdef XMK_ADD_PRINTF_ADDITIONAL
    PRINTF (("signal_id = %d\n", xmk_TmpSignalID));
    PRINTF (("xmk_TmpDataLength  = %d\n", xmk_TmpDataLength));
  #endif /* ... XMK_ADD_PRINTF_USER */

  #ifdef XMK_ADD_MICRO_ENVIRONMENT
    /* BEGIN User Code (external env section) */
    /*
    ** This part is used only, if an external environment is
    ** used on host side.
    */
    switch (xmk_TmpSignalID)
    {
     case StartResult :
     case SMSout :
     case UDPsendReq :
          cmd_data.signal = xmk_TmpSignalID;

          #ifdef XMK_USED_SIGNAL_WITH_PARAMS
            /*
            ** It is the user's task to ensure that 'xmk_TmpDataLength'
            ** is smaller than or equal to XMK_MAX_TSDL_PARAM.
            ** Please see the section 'Cmicro Tester/Trace/Length of one transmitter buffer'
            ** in the Bodybuilder.
            ** XMK_MAX_TSDL_PARAM = XMK_MAX_SEND_ONE_ENTRY -12
            */
            cmd_data.mess_length = xmk_TmpDataLength;
            memcpy(cmd_data.parametercopy, xmk_TmpDataPtr, xmk_TmpDataLength);
          #else
            cmd_data.mess_length = 0;
          #endif

          xmk_Cod_Encode (XMK_MICRO_ENVIRONMENT,
                          CMD_EXT_OUTPUT_TO_ENV_IND,
                          (char*)&cmd_data,
                          sizeof(xmk_T_CMD_EXT_OUTPUT_TO_ENV_IND)-sizeof(cmd_data.parametercopy)+xmk_TmpDataLength);
          xmk_result = XMK_TRUE;
          break;

      default :
        xmk_result = XMK_FALSE;/* to tell the caller that */
                               /* signal is NOT consumed  */
                               /* and to be handled by    */
                               /* the Cmicro Kernel ...    */
        break ;
    }
    /*   END User Code (external env section) */
  #endif /* ... XMK_ADD_MICRO_ENVIRONMENT */

  switch (xmk_TmpSignalID)
  {
     case StartResult :
          {
            /* BEGIN User Code */
            /* Use (yPDef_StartResult*)xmk_TmpDataPtr to access the signal's parameters */
            /* ATTENTION: the data needs to be copied. Otherwise is */
            /*            will be lost when leaving xOutEnv */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     case SMSout :
          {
            /* BEGIN User Code */
            /* Use (yPDef_SMSout*)xmk_TmpDataPtr to access the signal's parameters */
            /* ATTENTION: the data needs to be copied. Otherwise is */
            /*            will be lost when leaving xOutEnv */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     case UDPsendReq :
          {
            /* BEGIN User Code */
            /* Use (yPDef_UDPsendReq*)xmk_TmpDataPtr to access the signal's parameters */
            /* ATTENTION: the data needs to be copied. Otherwise is */
            /*            will be lost when leaving xOutEnv */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     case ProcUSSDReqReq :
          {
            /* BEGIN User Code */
            /* Use (yPDef_ProcUSSDReqReq*)xmk_TmpDataPtr to access the signal's parameters */
            /* ATTENTION: the data needs to be copied. Otherwise is */
            /*            will be lost when leaving xOutEnv */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     case USSDReqRes :
          {
            /* BEGIN User Code */
            /* Use (yPDef_USSDReqRes*)xmk_TmpDataPtr to access the signal's parameters */
            /* ATTENTION: the data needs to be copied. Otherwise is */
            /*            will be lost when leaving xOutEnv */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     case USSDAbortReq :
          {
            /* BEGIN User Code */
            /* Do your environment actions here. */
            xmk_result = XMK_TRUE; /* to tell the caller that */
                                   /* signal is consumed      */
            /*   END User Code */
          }
          break ;

     default :
          xmk_result = XMK_FALSE;/* to tell the caller that */
                                 /* signal is NOT consumed  */
                                 /* and to be handled by    */
                                 /* the Cmicro Kernel ...   */
          break ;
  }

  XMK_SUPPRESS(xmk_TmpDataLength);
  XMK_SUPPRESS(xmk_TmpDataPtr);
  XMK_SUPPRESS(xmk_TmpReceiverPID);

  #ifdef XMK_ADD_PRINTF_USER
    XMK_TRACE_EXIT("xOutEnv");
  #endif

  return (xmk_result);
} /* END OF FUNCTION */
#endif /* ... XMK_USE_xOutEnv */

#ifdef XMK_USE_xCloseEnv
/*
+------------------------------------------------------------------------------+
|  Functionname : xCloseEnv                                                    |
+------------------------------------------------------------------------------+
|                                                                              |
|  Description :                                                               |
|  This function is called by the Cmicro Kernel after termination.             |
|  It is not that useful in a Cmicro controler application, but may be so in   |
|  a simulation with the Cmicro Package.                                       |
|                                                                              |
|  Parameter    : -                                                            |
|  Return       : -                                                            |
|                                                                              |
+------------------------------------------------------------------------------+
*/
#ifndef XNOPROTO
  void xCloseEnv (void)
#else
  void xCloseEnv ()
#endif
{
  /* BEGIN User Code (variable section)*/
  /* It is possible to define some variables here */
  /*   END User Code (variable section)*/

  #ifdef XMK_ADD_PRINTF_USER
    XMK_FUNCTION("xCloseEnv");
  #endif

  /* BEGIN User Code (close section) */
  /* Do the actions here to close your environment */
  /*   END User Code (close section) */

  #ifdef XMK_ADD_PRINTF_USER
    XMK_TRACE_EXIT("xCloseEnv");
  #endif
} /* END OF FUNCTION */
#endif /* ... XMK_USE_xCloseEnv */

#endif /* ... __ENV_C_ */
